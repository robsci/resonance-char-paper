\documentclass[aps,prd,amsfonts,amssymb,amsmath,nofootinbib,showpacs,superscriptaddress,twocolumn,floatfix]{revtex4-1}
\usepackage{graphicx}
\usepackage{color}
%\usepackage{psfrag}
\usepackage{mathrsfs}
\usepackage[caption=false]{subfig}
\usepackage{dcolumn}
\usepackage[breaklinks=true]{hyperref}
\usepackage{textcomp}

\newcommand{\eqnref}[1]{Eq.~(\ref{eq:#1})}
\newcommand{\figref}[1]{Fig.~\ref{fig:#1}}
\newcommand{\Figref}[1]{Figure~\ref{fig:#1}}
\newcommand{\secref}[1]{Sec.~\ref{sec:#1}}
\newcommand{\apref}[1]{Appendix~\ref{sec:#1}}
\newcommand{\Tabref}[1]{Table~\ref{tab:#1}}

\newcommand{\units}[1]{\ensuremath{~\mathrm{#1}}}

\newcommand{\sub}[1]{\ensuremath{_\mathrm{#1}}}
\newcommand{\super}[1]{\ensuremath{^\mathrm{#1}}}
\newcommand{\dd}{\ensuremath{\mathrm{d}}}
\newcommand{\diff}[2]{\ensuremath{\dfrac{\dd {#1}}{\dd {#2}}}}
\newcommand{\linediff}[2]{\ensuremath{\dd {#1}/\dd {#2}}}
\newcommand{\diffop}[1]{\ensuremath{\dfrac{\dd}{\dd {#1}}}}
\newcommand{\difftwo}[2]{\ensuremath{\dfrac{\dd^2 {#1}}{\dd {#2}^2}}}
\newcommand{\linedifftwo}[2]{\ensuremath{\dd^2 {#1}/\dd {#2}^2}}
\newcommand{\difftwoop}[1]{\ensuremath{\dfrac{\dd^2}{\dd {#1}^2}}}
\newcommand{\diffn}[3]{\ensuremath{\dfrac{\dd^{#3} {#1}}{\dd {#2}^{#3}}}}
\newcommand{\linediffn}[3]{\ensuremath{\dd^{#3} {#1}/\dd {#2}^{#3}}}
\newcommand{\diffnop}[2]{\ensuremath{\dfrac{\dd^{#2}}{\dd {#1}^{#2}}}}
\newcommand{\partialdiff}[2]{\ensuremath{\dfrac{\partial {#1}}{\partial {#2}}}}
\newcommand{\linepartialdiff}[2]{\ensuremath{\partial {#1}/\partial {#2}}}
\newcommand{\partialdiffop}[1]{\ensuremath{\dfrac{\partial}{\partial {#1}}}}
\newcommand{\recip}[1]{\ensuremath{\frac{1}{#1}}}
\newcommand{\grad}{\ensuremath{\boldsymbol{\nabla}}}
\newcommand{\intd}[4]{\ensuremath{\int_{#1}^{#2}{#3}\,\dd{#4}}}
\newcommand{\order}[1]{\ensuremath{\mathcal{O}({#1})}}

\newcommand{\overlap}[2]{\ensuremath{\left(#1\middle|#2\right)}}

\DeclareMathOperator{\sgn}{sgn}

\begin{document}

%\preprint{}

\title{The importance of transient resonances in extreme-mass-ratio inspirals}

\author{Christopher P.L. Berry}
\email[]{cplb@star.sr.bham.ac.uk}
\affiliation{School of Physics and Astronomy, University of Birmingham, Edgbaston, Birmingham B15 2TT, United Kingdom}
\affiliation{Institute of Astronomy, Madingley Road, Cambridge, CB3 0HA, United Kingdom}
\author{Robert H. Cole}
\affiliation{Institute of Astronomy, Madingley Road, Cambridge, CB3 0HA, United Kingdom}
\author{Priscilla Ca\~{n}izares}
\affiliation{Institute of Mathematics, Astrophysics and Particle Physics, Radboud University, Heyendaalseweg 135, 6525 AJ Nijmegen, The Netherlands}
\author{Jonathan R. Gair}
\affiliation{School of Mathematics, University of Edinburgh, Peter Guthrie Tait Road, Edinburgh EH9 3FD, UK}

\date{\today}

\begin{abstract}
The inspiral of stellar-mass compact objects into supermassive black holes provides a wealth of information about the strong gravitational-field regime via the emission of gravitational waves. In order to detect and analyse these signals, accurate waveform templates are required. For computational efficiency, adiabatic templates are often used, which accurately reproduce orbit-averaged trajectories arising from the first-order dissipative gravitational self-force. Other effects are neglected, in particular that of transient resonances, where the radial and poloidal fundamental frequencies become commensurate. During such resonances, the flux of gravitational waves can be diminished or enhanced, leading to a shift in the compact object's trajectory and, ultimately, the phase of the emitted radiation. We investigate the properties of transient resonances. We present an evolution scheme for studying the effects of resonances and apply this to an astrophysically motivated population. We find that a large proportion encounter a low-order resonance in the later stages of inspiral; however, the resulting effect on signal-to-noise recovery is small as a consequence of the low eccentricity of the inspirals. Neglecting the effects of transient resonances leads to a loss of $4\%$ of detectable signals.
\end{abstract}

% 04.25.Nx 	Post-Newtonian approximation; perturbation theory; related approximations
% 04.30.-w 	Gravitational waves
% 04.70.-s 	Physics of black holes
% 98.62.Js 	Galactic nuclei (including black holes), circumnuclear matter, and bulges 
\pacs{04.25.Nx, 04.30.--w, 04.70.--s, 98.62.Js}

\maketitle

\section{Introduction}

In the prologue to his classic monograph, Chandrasekhar~\cite{Chandrasekhar1992} celebrates the simplicity of black holes (BHs). The Kerr solution is defined by just two parameters: mass and spin. Despite the baldness of the BH metrics, great intricacies manifest in their properties. This is made evident when a second body is introduced. The two-body problem in general relativity (GR) is well studied. It is of paramount importance for gravitational-wave (GW) astronomy, where binary systems are the dominant source of radiation. Correctly modelling the dynamics of these systems is necessary to interpret and extract information from gravitational waveforms.

We have made progress in understanding the general relativistic two-body problem in recent years. Bodies of comparable mass can be studied using numerical relativity. Rapid advances in this field have been made following breakthroughs in 2005~\cite{Pretorius2005,Campanelli2006,Baker2006}; it is now possible to simulate hundreds of orbits~\cite{Szilagyi2015}. These simulations allow us to understand binary BH coalescences. Stellar-mass BH mergers are targets for ground-based GW detectors, such as Advanced LIGO~\cite{Aasi2015} and Advanced Virgo~\cite{Acernese2015}, and the in-construction KAGRA~\cite{Aso2013}. The first direct observations of GWs came from the coalescences of two stellar-mass BHs~\cite{Abbott2016,Abbott2016e,Abbott2016d}, and analysis of their properties relied upon our understanding of binary BH waveforms~\cite{Abbott2016f,Abbott2016h,Abbott2016d}. %Supermassive BH (SMBH) coalescences, expected to be the result of galaxy mergers, are potential sources for a space-borne detector such as eLISA~\cite{Amaro-Seoane2012a}.

Systems of unequal masses are more challenging to evolve numerically as they complete a larger number of orbits, and it is necessary to resolve two different scales. Calculations can instead be performed perturbatively. The paradigm unequal-mass system has a stellar-mass BH orbiting a supermassive BH (SMBH), such as those expected to be found at the centres of galaxies~\cite{Kormendy1995,Ferrarese2005,Boehle2016}. These extreme-mass-ratio inspirals (EMRIs) produce GWs that are a promising signal for space-borne detectors like the evolving Laser Interferometer Space Antenna (eLISA)~\cite{Amaro-Seoane2007,Amaro-Seoane2012a}. Despite being well-studied, there still remain open questions in modelling generic binaries.

In the case of extreme-mass-ratio systems, efforts are concentrated on understanding the gravitational self-force~\cite{Barack2009,Poisson2004}. In the test-particle limit, the smaller body follows an exact geodesic of the SMBH's spacetime. Including the effects of the smaller body's finite mass, the background spacetime is perturbed. The back-reaction from this deformation alters the small body's orbital trajectory, and can be modelled as a self-force that moves the body from its geodesic. The self-force is commonly divided into two pieces, dissipative and conservative. The former encapsulates the slow decay of the orbital energy and angular momentum, constants of the motion in the test particle limit, through radiation. The latter shifts the orbital phases inducing precession. The dissipative piece is time-asymmetric and has the larger effect on the evolution of the orbital phase; the conservative piece is time-symmetric and has a smaller influence on the phase, although this can accumulate over many orbits. Being able to accurately model the influence of the self-force allows us to create reliable waveform models.

Flanagan and Hinderer~\cite{Flanagan2012} highlighted a previously overlooked phenomenon that occurs in the general relativistic two-body problem, that of transient resonances. Geodesic orbits in GR have three associated frequencies: the radial frequency $\Omega_r$, the polar frequency $\Omega_\theta$ and the azimuthal frequency $\Omega_\phi$.\footnote{In the strong-field regime, it is possible to have isofrequency pairings, where two different orbits share the same orbital frequencies~\cite{Warburton2013}. The evolution of the frequencies still differ, such that orbital trajectories can be reconstructed.} The first two describe libration and the third rotation (except in the case of polar orbits where $\Omega_\theta$ also describes rotation)~\cite{Goldstein2002}. % Section 10.6
In the weak-field limit, these all tend towards the Keplerian frequency; in the strong-field regime $\Omega_r < \Omega_\theta < \Omega_\phi$, and they may differ significantly. For EMRIs, the evolution timescale is much longer than the orbital period such that the motion of the smaller body is approximately geodesic over orbital timescales. The evolution of the orbit can be approximated as a series of geodesics using the osculating element formalism~\cite{Pound2008,Gair2011a}. During this evolution, the frequencies may become commensurate. Resonances occur when the radial and polar frequencies are rational multiples of each other:
\begin{equation}
\nu \equiv \frac{\Omega_r}{\Omega_\theta} = \frac{n_\theta}{n_r},
\end{equation}
where $n_r$ and $n_\theta$ are integers (with no common factors). During resonance, terms in the self-force that usually average to zero can combine coherently, significantly impacting the orbital motion~\cite{Flanagan2012a}.

Resonances involving the azimuthal motion do not produce a comparable effect because of the axisymmetry of the background spacetime. However, both $\theta$--$\phi$ resonances~\cite{Hirata2011} and $r$--$\phi$ resonances~\cite{VanDeMeent2013} can lead to extrinsic effects; the GWs from such systems are not emitted isotropically and the imbalance produces a kick velocity that is, in some cases, sufficient to eject the central BH from its host.

Geodesic motion in Kerr spacetime can be described by use of the action--angle formalism~\cite{Goldstein2002}. % Chapter 10
We consider a body of mass $\mu$ orbiting a BH of mass $M$, with $\eta = \mu/M \ll 1$,\footnote{To first order, the mass ratio $\eta$ is the same as the symmetric mass ratio $\mu M/(\mu+M)^2$.} and describe the motion in the directions of the standard Boyer--Lindquist coordinates $\{t,r,\theta,\phi\}$ using generalised angle variables $q_\alpha = \{q_t,q_r,q_\theta,q_\phi\}$ \citep{Hinderer2008}. We denote the first integrals of the geodesic motion, the generalised action variables, by $J_\alpha$. These are some combination of the energy per unit mass $E$ and the axial angular momentum per unit mass $L_z$, which arise from isometries of the metric in $t$ and $\phi$, and the Carter constant per unit mass squared $Q$~\cite{Carter1968}, which is related to the separability of the equations of motion in $r$ and $\theta$. The system evolves following~\cite{Flanagan2012}
\begin{subequations}
\label{eq:Mino-E-o-M}
\begin{align}
\diff{q_\alpha}{\lambda} = {} & \omega_\alpha(\boldsymbol{J}) + \eta g_\alpha^{(1)}(q_r,q_\theta,\boldsymbol{J}) + \order{\eta^2}, \\
\diff{J_\alpha}{\lambda} = {} & \eta G_\alpha^{(1)}(q_r,q_\theta,\boldsymbol{J}) + \order{\eta^2},
\end{align}
\end{subequations}
where $\lambda$ is Mino time~\cite{Mino2003}, and the forcing functions $g_\alpha^{(1)}$ and $G_A^{(1)}$ originate from the first-order self-force. By working with $\lambda$ instead of proper time $\tau$, the radial and polar motions decouple. At zeroth order in the mass ratio we recover the limit of purely geodesic motion: the integrals of the motion are actually constants and the angle variables evolve according to their associated frequencies $\omega_\alpha$.

The leading-order dissipative correction to geodesic motion is calculated following the adiabatic prescription~\cite{Hinderer2008}: by dropping the forcing term $g_\alpha^{(1)}$ (and all higher-order terms) and replacing the forcing term $G_\alpha^{(1)}$ with $\langle G_\alpha^{(1)}\rangle_{q_r,\,q_\theta}$, its average over the $2$-torus parametrized by $q_r$ and $q_\theta$~\cite{Drasco2005}. For most orbits this is sufficient, $G_\alpha^{(1)}$ is given by its average value plus a rapidly oscillating component~\cite{Arnold1988}. % Chapter 5, section 1
However, this averaging fails when the ratio of frequencies is the ratio of integers. In this case the trajectory does not ergodically fill the $2$-torus, but instead traces out a $1$-dimensional subspace.\footnote{For illustrations, see Grossman, Levin and Perez-Giz~\cite{Grossman2012}.} There are then contributions to the self-force that no longer average out beyond $\langle G_A^{(1)}\rangle_{q_r,\,q_\theta}$. Intuitively, we expect that this effect is more important for ratios of small integers since when the integers are large the orbit comes close to all points on the $2$-torus.

In this work we seek to characterise the importance of these resonances for the purposes of modelling EMRIs. The amplitude of expected signals is below the level of noise in a space-based GW detector. However, systems remain in band for many hundreds of thousands of cycles and so may be detected using a matched filter, provided we have sufficiently accurate waveform templates. Ensuring the accuracy of EMRI templates requires calculating the impact that passing through a resonance has on the orbital evolution and discovering for which resonances this is significant.

In \secref{problem}, we formulate the specific problem: that of geodesic motion in Kerr spacetime, perturbed by the gravitational self-force. We then study generic properties of transient resonances in \secref{properties}, detailing their location in parameter space, the timescales over which they affect the motion and the resulting GW flux enhancements. Specific examples are considered to illustrate the effects of resonances in \secref{waveforms}, before finally turning to an astrophysical population in \secref{astrophysics}. Our conclusions can be found in \secref{conclusion}.

We use geometric units with $G = c = 1$ throughout. We always use $M$ for the mass of the central SMBH and $a$ as its Kerr spin parameter. We also use the dimensionless spin $a_\ast \equiv a/M$; we take the convention that $0 \leq a_\ast < 1$. We assume a standard cosmology with $\Omega_\Lambda = 0.7$, $\Omega\sub{m} = 0.3$ and $H_0 = 70\units{km\, s^{-1}\, Mpc^{-1}}$ and do not expect the exact details of the cosmology to significantly alter our results~\cite{Mapelli2012}.

\section{The problem of EMRI transient resonances}
\label{sec:problem}

The evolution of an extreme-mass-ratio ($\eta \ll 1$) system is slow. Instantaneously, the motion of the orbiting mass can be described as geodesic, with the integrals of the motion changing on timescales of many orbital periods. It is therefore necessary to develop an understanding of the Kerr geodesics (\secref{geodesic}; those familiar with calculating orbits in Kerr may skip this section.). Transient resonance occur when the radial and polar frequencies become commensurate (\secref{frequencies}); we analyse the behaviour of resonances within the osculating element framework, where the trajectory is described by a sequence of geodesics that each match onto the motion at a particular instance (\secref{forced-motion}). The osculating elements formalism allows for the orbital evolution to be driven by a force, here, a particular model for the self-force (\secref{self-force}) and its adiabatic average (\secref{adiabatic}). In following sections, we study the differences between the adiabatic and full orbital evolutions.

\subsection{Kerr geodesics}
\label{sec:geodesic}

Central to understanding transient resonances is a knowledge of orbits in Kerr spacetime, and hence we begin with details of evolving Kerr geodesics. The geodesic equations may be written as~\cite{Carter1968, Chandrasekhar1992} % section 62
\begin{subequations}
\begin{align}
\diff{t}{\lambda} = {} & a\left(L_z - aE\sin^2 \theta\right) + \frac{r^2 + a^2}{\Delta}\mathcal{T},\\
\diff{r}{\lambda} = {} & \pm \sqrt{V_r},\\
\diff{\theta}{\lambda} = {} & \pm \sqrt{V_\theta},\\
\diff{\phi}{\lambda} = {} & \frac{L_z}{\sin^2 \theta} - aE + \frac{a}{\Delta}\mathcal{T},
\end{align}
\end{subequations}
where $\Delta = r^2 - 2M r + a^2$; the signs of the $r$ and $\theta$ equations can be chosen independently, and we have introduced potentials
\begin{subequations}
\begin{align}
\mathcal{T} = {} & E\left(r^2 +a^2\right) - aL_z,\\
V_r = {} & \mathcal{T}^2 - \Delta\left[r^2 + \left(L_z -aE\right)^2 + Q\right],\\
V_\theta = {} & Q - \cos^2 \theta\left[a^2\left(1 - E^2\right) + {\displaystyle \frac{L_z^2}{\sin^2\theta}}\right].
\end{align}
\end{subequations}
As an affine parameter, we have used Mino time which is related to the proper time $\tau$ by~\cite{Mino2003}
\begin{equation}
\tau = \intd{}{}{r^2 + a^2 \cos^2\theta}{\lambda}.
\end{equation}
Using Mino time allows us to decouple the $r$ and $\theta$ motions.

We only consider bound motion~\cite{Wilkins1972}: the radial motion covers a range $r\sub{p} \leq r \leq r\sub{a}$, where the turning points are the periapsis $r\sub{p}$ and apoapsis $r\sub{a}$. Drawing upon Keplerian orbits we parametrize the motion using
\begin{equation}
r = \frac{p M}{1+e\cos\psi},
\end{equation}
introducing eccentricity $e$, (dimensionless) semilatus rectum $p$ and relativistic anomaly $\psi$~\cite{Darwin1961,Drasco2004}. While $r$ oscillates between its maximum and minimum values, $\psi$ increases secularly, increasing by $2\pi$ across an orbit. The polar motion covers a range $\theta_- \leq \theta \leq \pi - \theta_-$. We also parametrize this motion in terms of an angular phase $\chi$, according to~\cite{Hughes2000}
\begin{equation}
\cos\theta = \cos\theta_-\cos\chi.
\end{equation}
While $\psi$ and $\chi$ are $2\pi$ periodic they are not the canonical action--angle variables~\cite{Schmidt2002}; they are, however, easy to work with.

The geodesic motion can equally be described by $\{E,L_z,Q\}$ or $\{p,e,\theta_-\}$~\cite{Schmidt2002}. Converting between them requires finding the solutions of $V_r = 0$ and $V_\theta = 0$. We employ a slightly different parameter set of $\{p,e,\iota\}$ where we have introduced the inclination~\cite{Ryan1996,Glampedakis2002}
\begin{equation}
\tan \iota = \frac{\sqrt{Q}}{L_z}.
\end{equation}
This is $0 \leq \iota < \pi/2$ for prograde orbits and $\pi/2 < \iota \leq \pi$ for retrograde orbits. Equatorial orbits ($\theta_- = \pi/2$) have $\iota = 0$ or $\pi$ and polar orbits ($\theta_- = 0$) have $\iota = \pi/2$. While formulae exist for conversion between the different parameters, these are complicated and uninsightful, so we do not reproduce them here.\footnote{In practice we find turning points numerically.}

\subsection{Orbital resonances}
\label{sec:frequencies}

The radial and polar orbital periods in Mino time are given by
\begin{subequations}
\begin{align}
\Lambda_r = {} & 2\intd{r\sub{p}}{r\sub{a}}{\recip{\sqrt{V_r}}}{r} = \intd{-\pi}{\pi}{\diff{\lambda}{\psi}}{\psi}, \\
\Lambda_\theta = {} & 4\intd{\theta_-}{\pi/2}{\recip{\sqrt{V_\theta}}}{\theta} = \intd{-\pi}{\pi}{\diff{\lambda}{\chi}}{\chi}.
\end{align}
\end{subequations}
The orbital frequencies are thus~\cite{Fujita2009}
\begin{equation}
\Upsilon_r = \frac{2\pi}{\Lambda_r}, \quad \Upsilon_\theta = \frac{2\pi}{\Lambda_\theta}.
\end{equation}
The geodesic equations for coordinate time $t$ and azimuthal angle $\phi$ are just functions of $r$ and $\theta$, hence their evolutions can be expressed as Fourier series~\cite{Drasco2004}
\begin{subequations}
\begin{align}
\diff{t}{\lambda} = {} & \sum_{k_r,\,k_\theta}T_{k_r,\, k_\theta}\exp\left[-i\left(k_r\Upsilon_r + k_\theta\Upsilon_\theta\right)\lambda\right], \\
\diff{\phi}{\lambda} = {} & \sum_{k_r,\,k_\theta}\Phi_{k_r,\, k_\theta}\exp\left[-i\left(k_r\Upsilon_r + k_\theta\Upsilon_\theta\right)\lambda\right].
\label{eq:Mino-Fourier}
\end{align}
\end{subequations}
The $(0,\,0)$ coefficients in these series give the average secular rate of increase of these quantities. We define
\begin{equation}
\Gamma = T_{0,\,0}, \quad \Upsilon_\phi = \Phi_{0,\,0}
\end{equation}
to act as Mino-time frequencies. We can now convert to coordinate-time frequencies with~\cite{Drasco2004}
\begin{equation}
\Omega_r = \frac{\Upsilon_r}{\Gamma}, \quad \Omega_\theta = \frac{\Upsilon_\theta}{\Gamma}, \quad \Omega_\phi = \frac{\Upsilon_\phi}{\Gamma}.
\end{equation}

Transient resonances occur when the radial and poloidal motions are commensurate, when
\begin{equation}
\nu = \frac{\Upsilon_r}{\Upsilon_\theta} = \frac{\Omega_r}{\Omega_\theta} = \frac{n_\theta}{n_r}
\end{equation}
is the ratio of small integers. At this point, any Fourier series like those in \eqnref{Mino-Fourier} goes from being an expansion in two frequencies to being an expansion in a single frequency~\cite{Bosley1992}.

For a general non-resonant orbit there is no fixed correlation between the radial and polar coordinates. After a sufficiently long time, the trajectory comes arbitrarily close to every point in the range of motion (with $r\sub{p} \leq r \leq r\sub{a}$ and $\theta_- \leq \theta \leq \pi - \theta_-$); on account of the orbital precession, the whole space is densely covered. This does not happen on resonance, as the radial and polar motions are locked together such that we can express one as a function of the other, and so the trajectory keeps cycling over the same path. The points visited are controlled by the relative phases of the $r$ and $\theta$ motions. To represent this, we use the $r$ phase at the $\theta$ turning point $\psi_{\theta_-} = \psi(\chi = 0)$. Varying $\psi_{\theta_-}$ across its full range allows every point in the range of motion to be reached. Hence averaging over all values of $\psi_{\theta_-}$ for resonant orbits is equivalent to averaging over the $\psi$--$\chi$ $2$-torus for non-resonant orbits.

One might be concerned about the nature of resonances following the inclusion of the self-force: true geodesic motion only exists at zeroth order in $\eta$ and, while it is a good approximation over short timescales, for small $\eta$ there is a small disparity. The conservative piece of the self-force induces extra precession which leads to a slight shift in the orbital frequencies~\cite{Warburton2012}.\footnote{The Kolmogorov--Arnold--Moser (KAM) theorem states that when an integrable Hamiltonian (i.e. the case for motion in Kerr) is subject to a small perturbation the form of the orbits is preserved albeit slightly deformed~\cite{Arnold1963,Moser1973}. % Chapter II, section 3.3 d)
This should ensure that, in general, there are only small shifts in the orbital frequencies. However, the KAM theory is only valid for sufficiently incommensurate orbits: close to resonance it does not apply~\cite{Moser1973}. % Chapter V section 1. c) 
This is a further reason why resonances merit an in-depth investigation.}
The dissipative piece causes the frequencies to evolve and, hence, the resonance cannot persist for multiple orbits (without some feedback coupling). In effect, we are really considering a period of time about the resonant crossing. The instantaneous orbital frequencies oscillate back and forth around their averaged values. However, there is a time span when the frequencies are consistently close to being commensurate. During this time, the trajectory appears similar to a resonant trajectory, filling only a smaller region of the parameter space. It is this time period that is of interest for transient resonances~\cite{Bosley1992}.


\subsection{Osculating elements and forced motion}
\label{sec:forced-motion}

For generic EMRIs, there are two characteristic timescales: the fast orbital motion, related to the fundamental frequencies $\sim1/\Omega$, and the slow inspiral, related to the change in fundamental frequencies $\sim\Omega/\dot{\Omega}$, where an overdot denotes a derivative with respect to coordinate time $t$. These, along with the resonance timescale, are discussed more in \secref{res-time}. The two-timescale nature of the problem makes it ideally suited to the method of osculating elements~\cite{Pound2008,Gair2011a}: on short timescales, we analyse the unperturbed system resulting in geodesic motion, and then the long-term evolution is described by a sequence of instantaneous geodesics.

We require, at each instant in time, that the chosen geodesic matches the true position and velocity of the particle. This amounts to a specific choice of the orbital shape parameters (for example, the set $\{E,L_z,Q\}$ or the generalised action variables $J_\alpha$) and some initial phases at $t=t_0$ (for example, the set $\{\psi_0,\chi_0,\phi_0\}$). Collectively, these are referred to as \emph{osculating elements} and we denote them by $I^A(t)$, making explicit the variation with time. For a sequence of geodesics of a background spacetime, where the evolution is forced by some external acceleration (in our case from the self-force), we can calculate the evolution of the osculating elements $\dot{I}^A$. The specific equations for motion in Kerr are derived by Gair {\it{et al}}.~\cite{Gair2011a}. 

%Given geodesic motion in some background spacetime with Christoffel symbols $\Gamma^\alpha_{\beta\gamma}$, forced by some external acceleration $f^\alpha$, so that
%\begin{equation}
%\difftwo{x^\alpha}{\tau} + \Gamma^\alpha_{\beta\gamma}\diff{x^\beta}{\tau}\diff{x^\gamma}{\tau} = f^\alpha,
%\end{equation}
%we can calculate the evolution of the osculating elements $\dot{I}^A$. The specific equations for motion in Kerr are derived by Gair {\it{et al}}.~\cite{Gair2011a}.

\subsection{Gravitational self-force model}
\label{sec:self-force}

To follow the evolution of the inspiral we must have a means of prescribing the forcing acceleration. We work directly with the gravitational self-force, using the same post-Newtonian (PN) approximation as Flanagan and Hinderer~\cite{Flanagan2012}. For comparison, Flanagan, Hughes and Ruangeri~\cite{Flanagan2012a} use a Teukolsky-equation calculation of GW fluxes to account for the inspiral due to radiation reaction.

The self-force model uses the first-order PN terms of the dissipative self-force formulated in Flanagan and Hinderer~\cite{Flanagan2007} and the conservative force formulated in Iyer and Will~\cite{Iyer1993}, and Kidder~\cite{Kidder1995}. Since only the first PN terms are used, this prescription is of limited validity in strong fields. Both pieces of the self-force are computed assuming that the spin is small: the dissipative piece contains terms to $\order{a_\ast^2}$ and the conservative piece to $\order{a_\ast}$. This is suboptimal for high spins. We also find that this particular implementation of the self-force model marginally overestimates the adiabatic inspiral rate with respect to direct PN evolutions by a factor of $\mathcal{O}(1)$, even for systems in the weak field and with low values of the spin. While this approximate self-force is not perfect, it should serve as a guide for the behaviour of the full self-force, allowing us to assess the qualitative impact of resonances on EMRI detection.

%\emph{Add detail about why self-force model is rubbish. Comment on switching conservative piece off for population results.}

\subsection{Adiabatic evolution}
\label{sec:adiabatic}

Beyond geodesic motion in the Kerr spacetime, a test particle follows an accelerated trajectory determined by \eqnref{Mino-E-o-M}. This may be approximated by the adiabatic prescription~\cite{Hinderer2008} by dropping the forcing term $g_\alpha^{(1)}$ (and all higher-order terms) and replacing $G_\alpha^{(1)}$ with its average over the $2$-torus parametrized by $q_r$ and $q_\theta$, $\langle G_\alpha^{(1)}\rangle_{q_r,\,q_\theta}$~\cite{Drasco2005,Grossman2011}. The averaged force can be computed from the radiative field~\cite{Galtsov1982,Mino2003,Sago2006,Ganz2007}. This piece is purely dissipative and determines how the inspiral evolves due to the radiation of GWs.

To construct an adiabatic trajectory we need the $2$-torus-averaged fluxes of our osculating elements. To guarantee consistency, we average our instantaneous self-force. Computing an average of a quantity over the $\{q_r, q_\theta\}$ is trivial if it is parametrized in terms of these variables,
\begin{equation}
\left\langle \diff{X}{\lambda}\right\rangle_{q_r,\,q_\theta} = \frac{1}{(2\pi)^2}\intd{0}{2\pi}{\intd{0}{2\pi}{\diff{X}{\lambda}}{q_r}}{q_\theta}.
\end{equation}
However, we are using $\psi$ and $\chi$, as these are simpler to evolve; furthermore, we compute instantaneous co-ordinate time fluxes $\dot{X}$, not Mino-time fluxes. Changing variables gives an average of \cite{Drasco2005}
\begin{widetext}\begin{align}
\left\langle \diff{X}{\lambda}\right\rangle_{q_r,\,q_\theta} = {} & \frac{1}{\Lambda_r \Lambda_\theta}\intd{0}{2\pi}{\intd{0}{2\pi}{\left(\diff{\psi}{t}\right)^{-1} \left(\diff{\chi}{t}\right)^{-1} \left(\diff{t}{\lambda}\right)^{-2} \diff{X}{\lambda}}{\psi}}{\chi} \\
 = {} & \frac{1}{\Lambda_r \Lambda_\theta}\intd{0}{2\pi}{\intd{0}{2\pi}{\left(\diff{\psi}{t}\right)^{-1} \left(\diff{\chi}{t}\right)^{-1} \left(\diff{t}{\lambda}\right)^{-1} \dot{X}}{\psi}}{\chi}.
\label{eq:2torus-average}
\end{align}\end{widetext}
This average describes the Mino-time rate of change of the quantity $X$ over an orbit. To convert to a co-ordinate flux of the averaged quantity, we simply divide by the period $\Gamma$~\cite{Flanagan2012a}, defining
\begin{equation}
\dot{\left\langle X\right\rangle}_{q_r,\,q_\theta} = \frac{1}{\Gamma}\left\langle \diff{X}{\lambda}\right\rangle_{q_r,\,q_\theta}.
\end{equation}
It is convenient to calculate $\Gamma$ as
\begin{equation}
\Gamma = \left\langle \diff{t}{\lambda}\right\rangle_{q_r,\,q_\theta},
\end{equation}
using \eqnref{2torus-average}, as this allows us to eliminate $\Lambda_r$ and $\Lambda_\theta$ from the calculation.\footnote{We compute these integrals using a $300\times 300$ grid of $\{\psi,\chi\}$ values and employing a Newton--Cotes approximation in each dimension. The procedure requires $\mathcal{O}(10^5)$ separate evaluations of the derivatives at each time-step of an evolution, and so is computationally expensive to perform. However, the adiabatic derivatives vary on much longer timescales than the orbital motion (see \secref{res-time}), and so in practice, we can interpolate.}
%We calculate the adiabatic derivatives, as above, at three points in the inspiral spaced by $\delta t/\eta$ where $\delta t$ is the orbital time-step. When the system is close to the central point, we use a quadratic fit to estimate the adiabatic derivatives. Once the system evolves close to one of the boundaries, we update the interpolation points, taking the closest boundary to be the new central point.
The averaged fluxes successfully describe the leading-order secular evolution of the trajectory (as illustrated in \figref{good-traj}).

%In our parametrisation of the EMRI system, using $\{\psi,\chi\}$ rather than $\{q_r,q_\theta\}$, we must perform appropriate averages over this new $2$-torus. The osculating elements integration scheme involves computing derivatives with respect to coordinate time, and we shall often be interested in the averaged form of such derivatives. Given a function $X(\psi,\chi)$, we can calculate the 2-torus average \cite{Drasco2005} of the derivative with respect to Mino time in terms of precomputed quantities
%\begin{widetext}\begin{equation}
%\label{eq:2torus-average}
%\left\langle \diff{X}{\lambda}\right\rangle_{\psi,\,\chi} = \frac1{\Lambda_r\Lambda_\theta} \intd{0}{2\pi}{ \intd{0}{2\pi}{ \left(\diff{\psi}{t}\right)^{-1} \left(\diff{\chi}{t}\right)^{-1} \left(\diff{t}{\lambda}\right)^{-1} \dot{X} }{\chi} }{\psi}.
%\end{equation}\end{widetext}
%We then obtain a coordinate time derivative
%\begin{equation}
%\dot{\left\langle X\right\rangle}_{\psi,\,\chi} = \left.\left\langle \diff{X}{\lambda}\right\rangle_{\psi,\,\chi}\middle/\left\langle \diff{t}{\lambda}\right\rangle_{\psi,\,\chi}\right.,
%\end{equation}
%which is successful at describing the leading-order secular evolution of the trajectory, as illustrated in \figref{good-traj}.

%The effect of resonances must be completely contained within the pieces of the self-force left after subtraction of the $2$-torus-averaged pieces, $\hat{X}\equiv X-\langle X\rangle_{q_r,\,q_\theta}$. The adiabatic evolution, which contains only a single $2$-torus-averaged forcing term, will therefore not be affected by the occurrence of any transient resonances. Resonances still occur as the fundamental frequencies become commensurate, but as the system passes through each resonance, there is no additional effect on the evolution of the system.

%One method of studying the effect of resonances is then to compare an adiabatic evolution with an instantaneous evolution, using the full knowledge of the self-force. This may be a useful exercise to calibrate and verify adiabatic models that can be generated cheaply; however it cannot be used to distinguish between dephasing effects arising from resonances and those arising from conservative corrections to the phase variables, as both are explicitly eliminated from the adiabatic prescription. We therefore take a different approach, comparing the instantaneous evolution with a quasi-adiabatic evolution, generated by averaging the full available self-force over the $2$-torus, rather than just averaging the term $G_\alpha^{(1)}$.

%To be specific, we write \eqnref{Mino-E-o-M} as
%\begin{subequations}
%\begin{align}
%\label{eq:Mino-E-o-M2}
%\diff{q_\alpha}{\lambda} = {} & \omega_\alpha(\boldsymbol{J}) + \eta \langle g_\alpha\rangle_{q_r,\,q_\theta}(\boldsymbol{J}) + \eta \hat{g}_\alpha(q_r,q_\theta,\boldsymbol{J}), \\
%\diff{J_\alpha}{\lambda} = {} & \eta \langle G_\alpha\rangle_{q_r,\,q_\theta}(\boldsymbol{J}) + \eta \hat{G}_\alpha(q_r,q_\theta,\boldsymbol{J}),
%\end{align}
%\end{subequations}
%where $g_\alpha$ and $G_\alpha$ encapsulate all our knowledge about the self-force and may contain contributions from sub-leading terms in the mass-ratio expansion. The quasi-adiabatic evolution is then obtained by dropping the terms containing $\hat{g}_\alpha$ and $\hat{G}_\alpha$. For ease of notation, we shall drop the \emph{quasi-} identifier; all subsequent references to an ``adiabatic evolution'' in fact refer to a ``quasi-adiabatic evolution''.

The combination of a full instantaneous evolution and an adiabatic evolution allows us to systematically study the effect of transient resonances on EMRIs over the course of an inspiral. Before approaching this problem, we first investigate the properties of the resonances themselves.


\section{Properties of transient resonances}
\label{sec:properties}

The first step in studying the effect of transient resonances is to locate orbital parameters for which the frequencies are commensurate. We can calculate the frequencies and so we are left with the problem of solving $\Omega = n_r \Omega_r - n_\theta \Omega_\theta = 0$ numerically. When considering the full parameter set of $\{p,e,\iota,a_\ast,\nu\}$, it is apparent that the search for resonances becomes expensive as a consequence of the dimensionality. It is therefore useful to have a guide of where to look. In \apref{location} we build a simple approximate model as a starting point for the numerical search. The resonances occur at relatively small periapses, corresponding to regions of strong-field gravity. Having located where in an inspiral we can expect to encounter a transient resonance, we must now consider its impact. In \secref{res-time} we determine the characteristic timescales describing resonance, and in \secref{flux-enhance} we calculate the impact of passing through a resonance on the evolution of the orbit.

\subsection{timescales}\label{sec:res-time}

When analysing resonances it is useful to refer to a number of characteristic timescales.  We always use coordinate time $t$ for these, as this corresponds to what is measured by an observer at infinity. Translation to Mino time can be done with an appropriate factor of $\Gamma$. We use the orbital period $T$, the evolution timescale $\tau\sub{ev}$, the precession timescale $\tau\sub{pres}$ and the resonance timescale $\tau\sub{res}$.

The simplest timescales are the orbital periods $T_r = 2\pi/\Omega_r$, $T_\theta = 2\pi/\Omega_\theta$ and $T_\phi = 2\pi/\Omega_\phi$. These are the shortest in our set. We use $T$ to denote a timescale of the same order as the orbital periods.

We define the evolution timescale as
\begin{equation}
\tau\sub{ev} = \frac{\nu}{\dot{\nu}},
\end{equation}
where an overdot denotes a derivative with respect to $t$. In general, away from resonance, we take $\nu \equiv \Omega_r/\Omega_\theta$. This timescale sets the period over which there is a significant change in the frequencies. It acts as an inspiral timescale. It is long in all cases we study, $\tau\sub{ev} \sim \order{T/\eta}$. It is this property which makes EMRIs interesting, as we can follow the waveform for many cycles, accruing high signal-to-noise ratios. This is also what allows us to use the adiabatic prescription, as it means the trajectory moves slowly through different orbital parameters.

We use the precession timescale
\begin{equation}
\tau\sub{pres}(t) = \frac{2\pi}{|\Omega(t)|},
\label{eq:t-pres}
\end{equation}
with $\Omega(t) = n_r \Omega_r(t) - n_\theta \Omega_\theta(t)$, where the frequencies are calculated instantaneously and the integers are for the resonance of interest. This timescale becomes infinite exactly on resonance, but decreases as we get further from resonance, eventually becoming $\order{T}$. It measures the relative precession rate of the radial and polar motions and hence gives an indication of how long it takes to fill the entire $\psi$--$\chi$ $2$-torus.

We also use the resonance timescale
\begin{equation}
\tau\sub{res} = \left[\frac{2\pi}{\left|\left\langle\dot{\Omega}(0)\right\rangle_{q'}\right|}\right]^{1/2}.
\label{eq:t-res}
\end{equation}
Here $\dot{\Omega}(0)$ is the rate of change of $\Omega$ at resonance, which we take to be at $t = 0$. The instantaneous $\dot{\Omega}$ depends upon the orbital phase and oscillates about its mean trend over an orbit. We are interested in the averaged behaviour, not the periodic modulations about this, which is why we use the time-average $\langle\dot{\Omega}\rangle_{q'}$; here we use $q'$ to represent a phase that varies over an orbit with period of order $T$. Close to resonance, $\Omega(t)$ is well approximated by a first-order Taylor expansion, decreasing linearly with time; hence we make the approximation
\begin{equation}
\left|{\Omega(t)}\right| \simeq \left|\left\langle\dot{\Omega}(0)\right\rangle_{q'} t\right|.
\label{eq:Taylor-Omega}
\end{equation}
The resonant timescale should give an indication of the time over which we expect the effects of the resonance to be felt~\cite{Bosley1992}. Consider the phase of the Mino-time Fourier expansion on resonance; neglecting the constant, the resonant Fourier component has form
\begin{equation}
\varphi_{n_r,\,-n_\theta} \simeq \left(n_r\Upsilon_r - n_\theta\Upsilon_\theta\right)\lambda + \left(n_r\dot{\Upsilon}_r - n_\theta\dot{\Upsilon}_\theta\right)\lambda^2 + \ldots
\end{equation}
Typically, the first term is non-zero and this gives the familiar oscillation. On resonance, it is zero, leaving the next-order term to govern the behaviour~\cite{Flanagan2012}. Only once we have moved far enough away from resonance for the first term to dominate the second do we recapture the non-resonant behaviour. The first term (translating from Mino time to coordinate time) sets $\tau\sub{pres}$, the second sets $\tau\sub{res}$.

Since we have argued that the effect of resonance can be thought of as a consequence of not densely covering the $\psi$--$\chi$ $2$-torus, we might expect that $\tau\sub{pres}$, as well as $\tau\sub{res}$, could be used for setting the resonance duration: the resonance ends once sufficient time has elapsed that the $2$-torus could be filled. This is indeed the case. Let $t\sub{pres}$ be the time taken to fill the torus, then
\begin{align}
t\sub{pres} = {} & \tau\sub{pres}(t\sub{pres}) \\
 \simeq {} & \dfrac{2\pi}{\left|\left\langle\dot{\Omega}(0)\right\rangle_{q'} t\sub{pres}\right|}, \nonumber 
\end{align}
using \eqnref{t-pres} and \eqnref{Taylor-Omega}. Rearranging and using \eqnref{t-res} gives
\begin{equation}
t\sub{pres} \simeq \tau\sub{res}.
\end{equation}
The two timescales are equivalent: we preferentially use $\tau\sub{res}$ to denote the resonance width. It is shorter than the inspiral timescale, but longer than an orbital period, $\tau\sub{res} \sim \order{\eta^{1/2}\tau\sub{ev}} \sim \order{\eta^{-1/2}T}$~\cite{Flanagan2012,Gair2011a}; it therefore acts as a bridge between the two timescales~\cite{Hinderer2008}.

Since we shall be considering Fourier decompositions, in anticipation of future results, we also define a timescale for the $s$-th resonant frequency harmonic
\begin{align}
%\tau_{\mathrm{pres},\,s} = {} & \frac{2\pi}{|s\Omega(t)|};\\
\tau_{\mathrm{res},\,s} = {} & \left[\frac{2\pi}{\left|s\left\langle \dot{\Omega}(0)\right\rangle_{q'}\right|}\right]^{1/2}.
\label{eq:T-res-s}
\end{align}
This assumes that $s$ is a non-zero integer.

\subsection{Resonant flux enhancement}
\label{sec:flux-enhance}

Evolving through a resonance can lead to an enhancement (or decrement) of fluxes relative to the adiabatic prescription. After crossing the resonance region, the orbital parameters are different from those calculated from an adiabatic evolution. Flanagan and Hinderer~\cite{Flanagan2012} gave an expression for this deviation. If we denote the orbital parameters by $\mathcal{I}^a = \{E,L_z,Q\}$, then the change across resonance is
\begin{align}
\Delta \mathcal{I}^a = {} & \eta\sum_{s\,\neq\,0}F_{a,\,s}^{(1)}\left[\dfrac{2\pi}{\left|s \left\langle\dot{\Omega}\right\rangle_{q'}\right|}\right]^{1/2} \nonumber \\*
 {} & \times {} \exp\left[i\left(s \widehat{\kappa}_0 + \dfrac{\pi}{4} \sgn s\dot{\Omega}\right)\right]. 
\end{align}
Here $\widehat{\kappa}_0$ is the orbital phase on resonance and $F_{a,\,s}^{(1)}$ is the $s$-th harmonic of the first-order self-force on resonance, defined such that\footnote{Since the geodesic equations decouple in Mino time rather than coordinate time, this is true only in an average sense.}
\begin{equation}
\diff{\mathcal{I}^a}{t} = \eta\sum_s F_{a,\,s}^{(1)}(\boldsymbol{\mathcal{I}})\exp(is q) + \order{\eta^2}.
\end{equation}
A derivation is presented in \apref{res-asymptotic}, which contains a more comprehensive explanation of the various terms. This employs matched asymptotic expansions to track the evolution through resonance, following the approach of Kevorkian~\cite{Kevorkian1987}.

To explain the form of this expression we substitute in our expression for the resonance width from \eqnref{T-res-s},
\begin{equation}
\label{eq:delta-I-a}
\Delta \mathcal{I}^a = \eta\sum_{s\,\neq\,0}F_{a,\,s}^{(1)}\tau_{\mathrm{res},\,s}\exp\left[i\left(s \widehat{\kappa}_0 + \dfrac{\pi}{4} \sgn s\dot{\Omega}\right)\right]. 
\end{equation}
Schematically, this can then be understood as the magnitude of the forcing function on resonance $\sim \eta F_{a,\,s}$ multiplied by the time on resonance $\sim \tau_{\mathrm{res},\,s}$ and a function that varies with the phase $\widehat{\kappa}_0$. Averaging over all values of $\widehat{\kappa}_0$ is equivalent to averaging over all values of $\psi_{\theta_-}$, and has the same effect as averaging over the $\psi$--$\chi$ $2$-torus~\cite{Grossman2011}; this gives an average discrepancy relative to the adiabatic evolution of
\begin{equation}
\left\langle \Delta \mathcal{I}^a \right\rangle_{\hat{\kappa}_0} = 0,
\end{equation}
exactly as expected.

Knowing where resonances are found in parameter space, how long they last, and how great an effect they are likely to have, enables us to study and interpret the observable effects of resonances on EMRI waveforms (\secref{waveforms}) and the population of observable inspirals (\secref{astrophysics}).


\section{The impact of resonances on EMRIs}
\label{sec:waveforms}

Having built an understanding of the properties of transient resonances, we now consider their impact on GW signals. In \secref{kludge} we discuss our chosen waveform generation scheme, giving a demonstration of its accuracy for evolutions which avoid low-order resonances in \secref{nonres}. In \secref{effres-phase} we detail the impact of resonances on the match between waveforms computed from adiabatic and fully instantaneous evolutions, and in \secref{effres-jump} we look at the changes in orbital parameters across resonance.

\subsection{Waveform model and analysis}
\label{sec:kludge}

One of the targets of pre-eLISA research is to generate a bank of waveform templates $\{h(t;\boldsymbol{\Theta}_i)\}$ across a range of parameter space $\{\boldsymbol{\Theta}_i\}$. These can be compared to data to search for the presence of GWs. Templates must accurately reproduce what we expect to observe in nature, without being too computationally expensive. Ideally, we would like to use waveform templates from EMRI systems that are evolved under the instantaneous self-force model, but these are computationally challenging. The alternative is to use cheaper adiabatic waveforms, but these do not include the effect of resonances. To assess the impact of this choice, we compare data $s(t;\bar{\boldsymbol{\Theta}})$ generated using the full self-force model (\secref{forced-motion}) to templates $h(t;\boldsymbol{\Theta})$ generated using our $2$-torus averaged self-force model (\secref{adiabatic}).

To generate gravitational waveforms, we employ the numerical kludge (NK) method of Babak {\it{et al}}.~\cite{Babak2007}, augmented to include evolution of the positional elements. We first compute inspiral trajectories and then separately (and not necessarily consistently) calculate the GW emission sourced by a compact object moving along that trajectory. This is quicker and easier to calculate than waveforms using Teukolsky-based methods (currently the most accurate prescription available) and yet gives similar results; agreement between Teukolsky-based and the best NK waveforms are typically $95\%$ or higher for a variety of orbits~\cite{Babak2007, Berry2013}.

Following the NK method, we first compute the inspiral trajectory of the compact object around a central Kerr BH with evolution driven by the dissipative part of self-force either calculated instantaneously or following the adiabatic prescription. We then map the Boyer--Lindquist coordinates to spherical polar coordinates in Minkowski, facilitating the use of a flat-spacetime waveform generation technique, the standard quadrupole formula~\cite{Misner1973}.

We expect these NK waveforms to be sufficiently accurate for our purposes, given the approximate (post-Newtonian, low-spin) self-force model (\secref{self-force}). Results can be straight-forwardly refined as developments are made in computing more comprehensive self-force models.

The similarity of two waveforms, $s(t)$ and $h(t)$, can be evaluated using the noise-weighted inner product~\cite{Finn1992}
\begin{equation}
\label{eq:innerprod}
\overlap{s}{h} = 2 \intd{0}{\infty}{\frac{\tilde{s}(f)\tilde{h}^*(f)+\tilde{s}^*(f)\tilde{h}(f)}{S_n(f)}}{f},
\end{equation}
where $\tilde{s}(f)$ represents the Fourier transform of $s(t)$ and similarly for $\tilde{h}(f)$, and $S_n(f)$ is the one-sided noise power spectral density (PSD)~\cite{Moore2014a}.\footnote{We use cubic interpolation to construct NK waveforms with identical time sampling. 
%In practice, the continuous functions $s(t)$ and $h(t)$ are not available, instead replaced by the time series $s(t_i)$ and $h(t_j)$ where $\{t_i\}$ and $\{t_j\}$ are equally-spaced sets of time values, but which do not necessarily have the same length or spacing. To take this into account, we project the $h(t_j)$ onto $\{t_i\}$ using a cubic interpolation scheme and set any values outside the domain of $\{t_j\}$ to zero.
%This whole procedure gives more accurate results than interpolating in the Fourier domain since the waveforms are smoother in the time domain.
A Planck-taper window function~\cite{McKechan2010} is applied to reduce unwanted spectral leakage in the Fourier transforms. 
%After tapering the projected waveforms, we then calculate overlaps using \eqnref{innerprod} but with discrete Fourier transforms and the integral over frequency replaced with an appropriate sum over Fourier modes.
}

We use the analytic approximation for the eLISA PSD of Amaro-Seoane {\it{et al}}.~\cite{Amaro-Seoane2012a}. Following the success for the LISA Pathfinder mission~\cite{Armano2016}, this sensitivity should be achievable in a future mission.

We wish to test whether there exists some set of parameters $\boldsymbol{\Theta}$ such that the resulting adiabatic waveform is sufficiently similar to the full waveform. We do this by evaluating the signal-to-noise ratio (SNR) for each (normalised) waveform template,
\begin{equation}
\rho\left[h\right] = \max_t \frac{\overlap{s}{h}}{\sqrt{\overlap{h}{h}}}.
\end{equation}
We maximise over the time offset for the template to find the best fit to the data. If a template exactly matches the data, it would produce an SNR of $\sqrt{\overlap{s}{s}}$, hence the overlap
\begin{equation}
\label{eq:overlap}
\mathbb{O}\left[h\right] = \frac{\overlap{s}{h}}{\sqrt{\overlap{s}{s}}\sqrt{\overlap{h}{h}}},
\end{equation}
which ranges from $0$ to $1$ provides a convenient indication of how well-matched the template is to the data.

\subsection{The non-resonant case}
\label{sec:nonres}

Before investigating the impact of resonances on an EMRI signal, we first compare results from the full instantaneous evolution and the $2$-torus averaged adiabatic evolution over $2~\mathrm{yr}$ for an inspiral which avoids any significant resonances. Example evolutions of the orbital parameters $E$, $L_z$ and $Q$ are shown in \figref{good-traj}, which shows that the adiabatic evolution closely matches the full evolution on longer inspiral timescales. The inset plots show the start of the evolution, on a timescale associated with the orbital motion of the compact object; the $2$-torus averaging explicitly smooths out the visible structure on this scale. The two appraches are in good agreement.

\begin{figure*}
\centering
\includegraphics[width=\textwidth]{Fig_good_traj}
\caption{\label{fig:good-traj}The evolution of the orbital parameters $E$ (left), $L_z$ (center) and $Q$ (right) under the full (solid line) and adiabatic (dashed) models for an illustrative EMRI system that does not encounter any significant resonances. The inset plots show the behaviour on short timescales, where the fast orbital oscillations can be seen. This system has $\mu = 10 M_{\odot}$, $\eta = 3\times 10^{-6}$, $a_\ast=0.95$, initial semilatus rectum $p_0 = 7.5$, initial eccentricity $e_0 = 0.7$, initial inclination $\cos \iota_0 = 0.5$ and redshift $z=0.204$.}
\end{figure*}

Using the two trajectories, we can calculate the corresponding NK waveforms. The two waveforms exhibit good agreement in both amplitude and phase across the entire duration. We find an overlap $\mathbb{O} = 0.993$, illustrating that adiabatic models can safely be used when resonances are not encountered.

\subsection{The effect of resonances: Dephasing and overlap}
\label{sec:effres-phase}

We now study a system that does pass through a resonance during its $2~\mathrm{yr}$ evolution. Specifically, we choose the initial conditions to be the same as in \secref{nonres}, but with an initial semilatus rectum $p_0 = 7.85$. This system passes through the $2$:$3$ resonance; the effect is to cause a shift in the orbital parameters (and hence the fundamental frequencies) that is not replicated by the adiabatic evolution, thus resulting in a rapid dephasing of the waveforms.

To illustrate the dephasing, we calculate as a function of time $t$ the shortened overlap between the two models, defined as the overlap obtained by including only the part of the waveform within $\Delta t$ of $t$. We choose $\Delta t$ such that we can calculate $25$ non-overlapping shortened overlaps. Before the resonance occurs, the adiabatic model provides a good match to the full evolution, but the overlap is reduced near to the resonance and never fully recovers afterwards. This is shown in \figref{overlap-dephasing}, which is centred on the time at which the full evolution crosses the $2$:$3$ resonance. Also shown is the shortened overlap computed between the full evolution and a different adiabatic evolution that is chosen to match the full evolution at the end of the integration. In this case, we see similar behaviour: the adiabatic waveform has a high overlap where it is constructed to match the full evolution, but this is disrupted by the resonance. Passing through resonance can adversely affect the overlap of adiabatic templates.

\begin{figure}
\centering
%\includegraphics[width=0.46\textwidth]{Fig_overlap_vs_time}
\includegraphics[width=0.4\textwidth]{Fig_overlap}
\caption{\label{fig:overlap-dephasing}The overlap computed between the full evolution and an adiabatic evolution for an illustrative EMRI system with $p=7.85$, as a function of time, including only the parts of the waveforms within some $\Delta t$ of $t$, arbitrarily chosen to give $25$ independent (non-overlapping) calculations. The time $t\sub{res} = 0$ is when the full evolution crosses the $2$:$3$ resonance.}
\end{figure}

To be able to detect signals, we must have templates which match the signals. We have seen that overlaps between adiabatic and full instantaneous evolutions dephase following a resonance. However, this does not necessarily mean that no adiabatic evolution has a low overlap with the observed signal. It is possible that a difference between the instantaneous and adiabatic waveforms could be ameliorated by changing the parameters of the template $\boldsymbol{\Theta}$. In this case, the waveform mismatch would not limit detectability of the signals, but would lead to errors in parameter estimation, a stealth bias caused by incorrect waveforms~\cite{Cutler2007}. We leave an investigation into the impact of transient resonances on parameter estimation to future work.\footnote{If resonances were successfully included in the waveforms used for parameter estimation, the sharp nature of jumps may help construct precise inferences of the source parameters~\cite{Mandel2014}.} However, we consider the possibility of obtaining better waveform matches by varying the parameters of the EMRI.

The large parameter space of adiabatic waveforms, coupled with the expensive nature of our $2$-torus averaging routine, renders a brute-force approach prohibitively expensive. For this preliminary investigation, we focus on a small subset of parameters that we suspect will produce a large overlap, and make the assumption that a good adiabatic model \emph{exactly} matches the full model at some time $t\sub{match}$. This reduces the search to a $1$-parameter family of waveforms that can easily be computed concurrently with the full evolution.

%This $1$-parameter family of adiabatic models does not explore the extrinsic parameter space of different orientations, nor does it consider different values of the constant intrinsic parameters (the masses of the BHs and the SMBH spin). It is possible that small deviations from these true parameters give rise to better matching adiabatic models, to partially correct for the (lack of) resonance effects. Exploring this parameter space would also reveal degeneracies between this parameters. The result of these restrictions is that the maximum overlap calculated using our family is a strict lower bound on the true maximum overlap.

The problem of searching over adiabatic templates now reduces to the task of choosing appropriate values of $t\sub{match}$. To demonstrate how changing the matching time affects the overlap, we use $5\tau\sub{res}$ after each resonance of interest, namely the low-order $1$:$2$ and $2$:$3$ resonances.\footnote{We adjust the values of $t\sub{match}$ so that they correspond to times of apoapsis. This ensures that the adiabatic model intersects with the full instantaneous model close to the centre of its oscillatory envelope, as demonstrated by the inset plots in \figref{good-traj}. This generally obtains better matches than if we match close to the extrema of the envelope, which are less representative of the average behaviour.} These matching times lie in a portion of the evolution that is not affected by a resonance, and so should allow for a large overlap with the adiabatic model for that region of the inspiral. For comparison, we also consider templates that match at the start and end of the evolution, and that match exactly on each of the resonances.

%We have tried a more rigid system of choosing the values of $t\sub{match}$, producing an adiabatic evolution regularly at fixed intervals, but these generally perform no better than our adaptive match points and require many more adiabatic evolutions to be calculated.

We have computed this family of adiabatic evolutions for our illustrative resonance. In \figref{res-diff-traj}, we plot the difference in the orbital parameters ($E$, $L_z$ and $Q$) between the various trajectories and the adiabatic evolution that matches at the start. The jumps in the orbital parameters due to the $2$:$3$ resonance can be clearly seen, as can the fast orbital oscillations present in the full instanteous evolution but absent in the adiabatic evolutions.

\begin{figure*}
\centering
\includegraphics[width=\textwidth]{Fig_res_diff_traj}
\caption{\label{fig:res-diff-traj}The differences in orbital parameters $E$ (left), $L_z$ (centre) and $Q$ (right) between each evolution scheme and the adiabatic model that matches at the start. The solid line shows the full evolution and the dashed lines show the different adiabatic evolutions, which match the full evolution at different times throughout the inspiral (numbers in parentheses give the overlap with the full evolution): at the start ($0.207$), at the $2$:$3$ resonance ($0.432$), after the $2$:$3$ resonance ($0.258$) and at the end ($0.677$).}
\end{figure*}

None of the adiabatic models presented here give a particularly high overlap with the entire signal, because of the effects of the resonance. In this case, the best-performing adiabatic model was that which matched at the end, giving $\mathbb{O} = 0.677$, while the model that matches at the start gives only $\mathbb{O} = 0.207$. These are similar overlaps from to the adiabatic evolutions matched before and after resonance respectively. These values can be explained qualitatively by the relative lengths of the adiabatic-like regions on either side of the resonance in the full evolution ($69.8\%$ of the inspiral is post-resonance): there is not an exact equivalence because of the frequency dependence of the PSD.

If we could construct an adiabatic model that includes the jump across resonances, it may give a good overall fit to the signal.

\subsection{The effect of resonances: Jump sizes}
\label{sec:effres-jump}

As explained in \secref{flux-enhance} and illustrated in \figref{res-diff-traj}, the full instantaneous evolution undergoes a rapid change in the orbital parameters (with respect to the adiabatic evolution) when passing through resonance. The size of the jump influences the subsequent orbital evolution.

To extract the magnitude of this jump from the trajectory data, we must account for the fast orbital oscillations as well as the general average (adiabatic) evolution~\cite{ColeThesis2015}. We first computed the difference $\Delta \mathcal{I}^a \equiv \mathcal{I}^a\sub{full} - \mathcal{I}^a\sub{ad}[t\sub{match} = t\sub{res}]$ between the orbital parameters calculated using from the full instantaneous evolution and from an adiabatic evolution matched to the parameters at resonance. We then fit linear bounds to the oscillating envelope, both before and after the resonance, using data $5\tau\sub{res}$ to $10\tau\sub{res}$ away. These are averaged to give general pre- and post-resonance trends, which are extrapolated to the time of resonance. The difference at the time of resonance gives an estimate for the jump $\Delta \mathcal{I}^a\sub{jump}$ in orbital parameter $\mathcal{I}^a$.\footnote{As a cross-check, comparable values for the jump are obtained by averaging (over an integer number of radial and poloidal orbits) the flux on a resonant geodesic~\cite{ColeThesis2015}.} \Figref{res-jump-calc} illustrates how the size of the jump is calculated.

%To achieve this, we isolate spans of data away from the resonance; specifically, looking at data that lies within five and ten resonance timescales away. For both the pre- and post-resonance datasets, we compute $\Delta \mathcal{I}^a \equiv \mathcal{I}^a\sub{full} - \mathcal{I}^a\sub{ad}[t\sub{match} = t\sub{res}]$ for each of the orbital parameters~\cite{ColeThesis2015}. We then identify the most horizontal straight lines that bound the data, which give an approximation to the behaviour of the fast orbital oscillations. The resulting data and bounding lines are shown for our illustrative system in \figref{res-jump-calc}.

%To estimate the size of the jump $\Delta \mathcal{I}\sub{jump}$, we extrapolate the bounding lines to the resonance time and calculate the difference between the pre- and post-resonance values, quoting the final result as the average of that obtained using the upper and lower limits. This allows us to take into account any linear drift in $\Delta \mathcal{I}$ that can occur over the resonance timescale due to the inaccuracy of the adiabatic approximation.
% In addition, by using information from both the upper and lower limits, we can veto jump calculations that appear erroneous: if one jump is positive and the other negative, then we ignore that resonance; this often occurs very near to plunge, where the adiabatic approximation breaks down. 
%For typical systems, this numerically computed jump appears to well describe the resonance, as shown by the red dotted line in \figref{res-jump-calc}.

%We can study the predicted orbital-parameter jumps numerically by considering the long-time-average fluxes for particular (fixed) geodesics. For non-resonant geodesics, this will depend only on the orbital shape parameters, but for resonant orbits there will be an additional dependence on the initial phase difference. We consider a selection of different orbital shape parameters corresponding to low-order resonances and calculate the time-averaged fluxes for $50$ different initial phases. We evolve for an integer number of cycles of both the radial and polar motions. Specifically, when considering a $n_\theta$:$n_r$ resonance, we take $T = 2\pi N n_\theta/\Omega_r = 2\pi N n_r/\Omega_\theta$ for some integer $N$. We have found that taking $N=5$ gives sufficiently accurate results. We can then estimate the jumps by taking the difference between the maximum and minimum time-averaged fluxes.

\begin{figure}
\centering
\includegraphics[width=0.46\textwidth]{Fig_res_jump_calc}
\caption{\label{fig:res-jump-calc}The difference in energy between the instantaneous model and adiabatic model that matches at the $2$:$3$ resonance, scaled by the magnitude of the $2$:$3$ resonance jump. The dashed green (yellow) lines show the bounding fits to the data before (after) the resonance, used to numerically estimate the size of the jump. The dotted red line indicates the computed size of the jump. The time axis is centred on the $2$:$3$ resonance and is scaled by the resonance timescale $\tau\sub{res}$.}
\end{figure}

The absolute size of the resonance jump is often not particularly useful, especially when comparing different systems. Instead, we use the fractional enhancement relative to the adiabatic evolution,
\begin{equation}
\label{eq:res-jump-ratio}
\delta \mathcal{I}^a = \frac{\Delta \mathcal{I}^a\sub{jump}}{\dot{\mathcal{I}}^a\sub{ad}(t\sub{res})\tau\sub{res}}.
\end{equation}
Relative enhancements may be of the order of a few percent.

The jump in orbital parameters depends sensitively on the relative phase of radial and poloidal motions. This can be illustrated using an ensemble of orbits with different orbital phases $\psi_{\theta_-}$. According to \eqnref{delta-I-a}, the jumps should oscillate as a function of the phase $q$.\footnote{The overlaps for all of these different phases are similar, clustering around $0.7$, as expected from matching the post-resonance region of the waveform.} Therefore, assuming that the lowest harmonic dominates, plotting a jump in one parameter against another should trace out an ellipse. We find that this is the case; in \figref{resjump-vs-q} we plot resonant jumps as a function of the phase $q$ constructed from the $\Delta E\sub{jump}$--$\Delta L_{z\,\mathrm{jump}}$ ellipse. The jumps in $E$ and $L_z$ are approximately in phase, but those in $Q$ are found to be offset~\cite{Flanagan2012a}; this means that for every value of $q$, there is always a resonance jump in at least one parameter.

\begin{figure}
\centering
%\includegraphics[width=0.46\textwidth]{Fig_jump_vs_q}
\includegraphics[width=0.4\textwidth]{Fig_q_jump}
\caption{\label{fig:resjump-vs-q}The magnitude of the resonance jump for our illustrative system as a function of the extracted phase parameter $q$ (cf.\ figure 3 of \cite{Flanagan2012a}). The jump is relative to the adiabatic change in each parameter across resonance. The individual jumps as well as a sinusoidal fit are plotted for the energy $E$, angular momentum $L_z$ and Carter constant $Q$.}
\end{figure}

%For each system, we compute the overlap between the full evolution and the family of adiabatics given by our set of match times $t\sub{match}$ described in the previous section. The largest overlap in each case appears to be roughly independent of the value of $q$ and hence with the relative sizes of the orbital parameter jumps. Systems with $|q| \approx \pi/2$ (corresponding to small jumps in $E$ and $L_z$) have higher than average overlaps due to additional accumulation in the pre-resonance region. The adiabatic models of these systems dephase more slowly, but still do not produce very high overlaps due to the jump in $Q$. We expect the overlap to scale with the fraction of time spent post-resonance.

Let us now consider jumps for systems other than our illustrative $2$:$3$ resonance. We expect nearly-circular orbits to encounter smaller jumps than more eccentric orbits because they have a smaller $r$--$\theta$ $2$-torus, meaning that resonant orbits come closer to every allowed point, nearer approximating a non-resonant orbit. In \figref{res-flux-rms-p}, we show the root-mean-square (over a grid of $a_\ast$ and $\cos\iota$ values) relative resonant jump for the semilatus rectum as a function of eccentricity for a selection of low-order resonances. The other orbital shape parameters show a similar trend with increasing eccentircity~\cite{ColeThesis2015}. Larger eccentricities do give rise to larger jumps, matching our expectations and Teukolsky-based calculations by Flanagan, Hughes and Ruangsri~\cite{Flanagan2012a}.

\begin{figure}
\centering
%\includegraphics[width=0.46\textwidth]{res_flux_rms_p}
\includegraphics[width=0.4\textwidth]{Fig_e_rms_p}
\caption{\label{fig:res-flux-rms-p}Relative flux enhancements for the semilatus rectum $p$, as a function of $e$, marginalised over $a_\ast$ and $\cos\iota$ by taking the root-mean-square of a grid of values. Resonances with $n_\theta = 1$ ($2$; $3$) are coloured blue (gold; red). The $2$:$3$ resonance has the largest relative flux enhancement.}
\end{figure}

We also expect that the effects of passing through resonance depend upon the particular resonance. Intuitively, we would expect that when $n_\theta$ and $n_r$ are large, the effects of resonance will be small, since the orbit comes close to all points on the $2$-torus. We have already seen that this is the case, as the adiabatic evolution is a good match to the instantaneous evolution up until it hits a resonance which is the ratio of small integers (like $2$:$3$). In \figref{res-flux-rms-p-vsnu} we plot the root-mean-square (over $a_\ast$ and $\cos\iota$) relative resonant jump for the semilatus rectum as a function of the resonance ratio $\nu$ for various $n_\theta$, the eccentricity is set to $e=0.95$ to emphasise the variation.

While we might naively expect jumps with $n_\theta = 1$ to be greatest, we see that this is not the case. Instead the $n_\theta = 1$ and $n_\theta = 2$ jumps form a single continuum: we can treat $1$:$x$ resonances as \emph{de facto} $2$:$2x$ resonances. This suggests that more insight into resonance jumps could be gained from considering the motion across two radial periods, even for resonances with $n_\theta = 1$. Moving beyond $n_\theta = 2$, we see that the magnitude of jumps decreases rapidly for $n_\theta = 3$~\cite{Flanagan2012a}. For larger $n_\theta$, jumps are so small that cannot accurately calculate them.

\begin{figure}
\centering
%\includegraphics[width=0.46\textwidth]{res_flux_rms_p_e095}
\includegraphics[width=0.4\textwidth]{Fig_nu_rms_p}
\caption{\label{fig:res-flux-rms-p-vsnu}Relative flux enhancements for the semilatus rectum $p$ marginalised over $a_\ast$ and $\cos\iota$ by taking the root-mean-square. Resonances with $n_\theta = 1$ ($2$; $3$) are coloured blue (gold; red) and use circular (square; triangular) points.}
\end{figure}

\section{Astrophysical implications}
\label{sec:astrophysics}

Strong resonances can limit our ability to recover SNR from waveforms using adiabatic templates; they partition the inspiral, splitting up the total SNR into different adiabatic regions, which may be individually undetectable. In order to assess the impact of this on future GW missions, we need to analyse the waveforms from a population of detectable EMRIs. In \secref{EMRI-population}, we detail our procedure for generating an astrophysically motivated distribution of EMRIs, before turning to the effect of resonances on the detectability of EMRIs in \secref{population-SNR}.

\subsection{Sample EMRI population}
\label{sec:EMRI-population}

The EMRI event rate depends on the exact composition of the population of compact objects around each SMBH, the stellar density profile for each species of compact object, and the mass and spin of each SMBH~\cite{Alexander2005}, all of these properties are highly uncertain, even for our own Galaxy. Here, we sketch out a model which includes most of the important effects, which should suffice for illustrating the potential impact of transient resonances on the rate of detection.

\subsubsection{Population model}

To generate a representative EMRI population, we need to establish plausible distributions for the parameters defining the EMRI: the properties of the orbiting compact objects, the properties of the central SMBHs, and the properties of the orbits. 

EMRIs require a compact object such as a white dwarf, a neutron star or a stellar-mass BH to orbit around a SMBH. Main-sequence stars are tidally disrupted before they can complete the inspiral~\cite{Rees1988,Sigurdsson1997}. We expect the EMRI event rate to be dominated by BHs as the most massive species of compact object~\cite{Gair2004}. First, as BHs are more massive than white dwarfs or neutron stars, their GW signal is louder~\cite{Peters1963,Barack2004} and hence detectable EMRIs can come from a larger volume. Second, dynamical friction in the dense nuclear star clusters~\cite{Chandrasekhar1960,Antonini2011} also leads to mass segregation, causing the most massive objects concentrate closer to the SMBH~\cite{Bahcall1977,Freitag2006,Alexander2009}. We therefore expect BHs to dominate the inner regions of nuclear star clusters, making them the most probable candidate to inspiral. We adopt a fiducial mass for the compact object of $\mu = 10 M_\odot$, corresponding to a typical mass for stellar BHs~\cite{Casares2014,Corral-Santana2016,Tetarenko2016,Abbott2016d}.\footnote{If the $\sim30 M_\odot$ BHs of GW150914~\cite{Abbott2016f,Abbott2016d} are common, then this would enhance the EMRI rate.}

We take the central object to be a typical SMBH at the centre of a galaxy~\cite{Kormendy1995,Ferrarese2005}; we are interested in galaxies that possess a SMBH with a mass in the range $(10^{4}$--$10^7) M_\odot$, as these give rise to EMRIs in the frequency band of space-based GW detectors~\cite{Amaro-Seoane2007,Amaro-Seoane2012a}. We consider the EMRI event rate as the combination of two pieces: the comoving number density of SMBHs in the Universe, which is the same as that of galaxies if we assume all galaxies host a single SMBH~\cite{Lynden-Bell1971,Soltan1982}, and the intrinsic event rate per SMBH $\mathcal{R}$, the number of inspiral events per unit time for a given galaxy.

The comoving number density of galaxies is challenging to estimate because of the effects of local structure in the Universe, the evolution of that structure, and properties of the SMBHs themselves. We simplify the problem by assuming a homogeneous distribution that does not evolve with redshift, which is reasonable for the typical scales considered by GW detectors. We also neglect correlations between the SMBH mass and spin~\cite{Volonteri2010,Dotti2013,Sesana2014}, and impose a power-law scaling relation for the comoving number density
\begin{equation}
\diff{n}{\,\ln M} = n_0 \left(\frac{M}{M_0}\right)^\beta.
\end{equation}
There is significant uncertainty in the SMBH mass function, but this simple functional form is found to be in good agreement with observations from the Sloan Digital Sky Survey for the mass range of interest; we use $\beta = 0$ and $n_0 = 0.002~\mathrm{Mpc}^{-3}$ for SMBHs with $M < \order{10^7 M_\odot}$~\cite{Greene2007, Gair2010b}.

Simple estimates of the intrinsic rate $\mathcal{R}$ have been carried out using Monte-Carlo methods to count the number of compact objects from isothermal distributions that spiral in to a SMBH without plunging~\cite{Merritt2013}. The result is a scaling law for each species of compact object of the form
\begin{equation}
\label{eq:EMRI-intrinsic-rate}
\mathcal{R}(M) = \mathcal{R}_0 \left(\frac{M}{M_0}\right)^\alpha,
\end{equation}
where $M$ is the mass of the SMBH and $M_0 = 3\times 10^6 M_\odot$ is a fiducial mass. Hopman~\cite{Hopman2009a} finds that $\alpha = \{-0.15,\,-0.25,\,-0.25\}$ for BHs, neutron stars and respectively, with respective event rates $\mathcal{R}_0 = \{400,\, 7,\, 20\}~\mathrm{Gyr}^{-1}$ for each component, showing how BHs dominate the event rate. Amaro-Seoane and Preto~\cite{Amaro-Seoane2011d} studied the effects of mass segregation on the intrinsic EMRI event rate, using direct-summation $N$-body simulations to calibrate a Fokker--Planck description for the bulk properties of the stellar distribution. They found a better fit for the power-law spectral index for BHs of $\alpha = -0.19$, which we use here. The simple power-law description does not incorporate the effects of either resonant relaxation~\cite{Rauch1996,Rauch1998,Merritt2011} or anomalous relaxation~\cite{Hamers2014,Merritt2015c}, ignores the spin of the SMBH~\cite{Amaro-Seoane2012b}, and assumes that the $M$--$\sigma$~\cite{Ferrarese2000,Graham2016} relation holds for all SMBH masses (cf.\ \cite{Hlavacek-Larrondo2012,Ferre-Mateu2015,VanLoon2015,Trakhtenbrot2015,King2016}). Each of these is likely to  impact the event rate, but \eqnref{EMRI-intrinsic-rate} can still be used as a rough guide to the expected number of events.

Combining the intrinsic event rate with the comoving number density, the mass of the SMBH for the EMRI population is then sampled from a power-law with a probability distribution function $f(M) \propto M^{\alpha+\beta-1}$.

We distribute the SMBH's dimensionless spin $a_\ast$ uniformly between its limiting values of $0$ and $1$. X-ray measurements show that SMBH spins can take a range of values~\cite{Reynolds2013a,Patrick2012,Walton2013,BerryThesis2013}; there is an observed preference for larger ($> 0.9$) spin values, but this may be a selection effect~\cite{Brenneman2011}. Therefore, the uniform prior is a safe choice given our ignorance of the true distribution. The direction of the spin is uniformly distributed across the surface of the unit sphere.

We distribute SMBHs uniformly throughout the Universe. We sample redshift of the source uniformly from comoving volume out to maximum redshift of $z\sub{max} = 1.5$, beyond which we cannot detect EMRIs. Sources are uniformly distributed across the sky. 

To describe the orbit we need to specify the inclination distribution, the eccentricity distribution and the   phase at periapsis. The inclination is uniformly distributed across all orientations (uniform in $\cos \iota$); the poloidal and azimuthal phases at periapsis are uniform between $0$ and $2\pi$. The eccentricity distribution is more complicated.

Eccentricities for EMRIs are uncertain, and depend strongly on the formation scenario being considered. Here, we adopt a fit to a distribution computed using Monte-Carlo simulations by Hopman and Alexander~\cite{Hopman2005}, who model the scattering process of compact objects onto inspiral orbits around a $3 \times 10^6 M_\odot$ Schwarzschild BH. We assume this can be extended to provide a rough estimate of the distribution around SMBHs of other masses and spins. At the point in the inspiral when the orbital period takes a fiducial value $T_0 = 10^4~\mathrm{s}$, we find that the Monte-Carlo eccentricity probability distribution function is well-described by a power-law with an exponential cutoff
%\begin{widetext}
\begin{equation}
\label{eq:EMRI-e-distribution}
f(e) \propto 
	\begin{cases}
		\left(e\sub{m}-e\right)^{b(e\sub{m}-e\sub{p})} \exp\left[b(e-e\sub{m})\right] & 0 \leq e \leq e\sub{m}\\
		0 & \mathrm{Otherwise}
	\end{cases},
\end{equation}
%\end{widetext}
where $e\sub{m} = 0.81$ is the maximum observed eccentricity, $e\sub{p} = 0.69$ is the peak of the distribution, and $b=11$ is the exponential index~\cite{ColeThesis2015}. The mean eccentricity at this period is $0.60$, slightly below that expected for a thermal distribution. Significant eccentricity is retained as EMRIs enter the eLISA frequency band~\cite{Merritt2015c}. 

To evolve the orbits, we start with orbital periods of $T_0$ and then use the analytic kludge (AK) prescription of Barack and Cutler~\cite{Barack2004}. This is similar to the NK approach, but uses a series of Keplerian ellipses rather than Kerr geodesics. Evolution of the orbit includes the effects of periapse precession, Lense--Thirring
precession, and radiation reaction calculated using PN expressions. AK waveforms are less computationally expensive than NK waveforms, allowing us to simulate a large population of EMRIs. We follow inspirals until the last stable orbit (LSO).\footnote{The LSO is determined numerically by calculating the roots of $V_r(r) = 0$, which we denote in ascending order by $r_4 \leq r_3 \leq r\sub{p} \leq r\sub{a}$, and stopping the evolution when $r_3 = r_p$, which designates the orbit as marginally stable. This ignores the (small) influence of the self-force.} Each of these systems is then evolved backwards for some time $t\sub{insp}$, chosen uniformly from the range $[0,t\sub{life}]$ for a mission lifetime $t\sub{life}$, and the expected GWs are calculated using the AK formalism.

\subsubsection{Population results}

The estimated size of the EMRI population can be by evaluating from~\cite{Gair2009}
\begin{equation}
\label{eq:EMRI-number}
N\sub{EMRI} = \intd{z\,=\,0}{z\sub{max}}{ \intd{M\,=\,M\sub{min}}{M\sub{max}}{\mathcal{R}t\sub{life}\diff{n}{\,\ln M} \diff{V\sub{c}}{z}}{\,\ln M}}{z},
\end{equation}
where $V\sub{c}(z)$ is the comoving volume at redshift $z$, and limits $z\sub{max} = 1.5$, $M\sub{min} = 10^4 M_\odot$ and $M\sub{max} = 10^7 M_\odot$ are chosen to encompass the range of detectable signals. For a mission lifetime of $t\sub{life} = 2\units{yr}$, the integral gives a total of $6330$ EMRI systems. This is a lower bound for $N\sub{EMRI}$ as we are neglecting EMRIs that merge outside the observation window but nevertheless accumulate sufficient SNR during this time to be observable.

A given EMRI is classified as observable if its SNR exceeds some threshold value $\rho\sub{thres}$. Calculating SNRs from the generated AK waveforms, assuming $6$ laser links and using the eLISA PSD~\cite{Amaro-Seoane2012a}, we find $513$ detectable events across the mission for $\rho\sub{thres} = 15$ (cf.\ \cite{Gair2004,Amaro-Seoane2012a,Mapelli2012}). The parameter distributions for the mass and spin of the SMBH, the orbital shape parameters at plunge, the redshift of the source, and the length of the observation $t\sub{insp}$ are shown in \figref{EMRIpar-dists}, to be contrasted with the distributions of the $5820$ systems with an SNR less than $15$, which are also shown.%Total = 5819 + 513 = 6332

\begin{figure*}
\centering
%\includegraphics[width=\textwidth]{EMRIpar_dists}
\includegraphics[width=0.37\textwidth]{Fig_res_pop_M} \quad
\includegraphics[width=0.37\textwidth]{Fig_res_pop_a} \\ \vspace{0.1cm}
\includegraphics[width=0.37\textwidth]{Fig_res_pop_z} \quad
\includegraphics[width=0.37\textwidth]{Fig_res_pop_p} \\ \vspace{0.1cm}
\includegraphics[width=0.37\textwidth]{Fig_res_pop_e} \quad
\includegraphics[width=0.37\textwidth]{Fig_res_pop_iota} \\ \vspace{0.1cm}
\includegraphics[width=0.37\textwidth]{Fig_res_pop_t} \quad
\includegraphics[width=0.37\textwidth]{Fig_res_pop_SNR}
\caption{\label{fig:EMRIpar-dists}Parameter distributions at plunge for our detectable EMRI systems (dashed outline), alongside those of the undetectable systems (solid outline). For the system parameters, the ordinate-axis values are the probability of a system being found in a particular bin, given that they are either detectable or undetectable. In the final plot for the SNR, we show the number of systems in each bin. The SNRs quoted here are calculated using the AK model and we assume a detection threshold of $\rho\sub{thres} = 15$.}
\end{figure*}

The mass distribution for detectable EMRIs is peaked such that the typical GW frequency occurs at the base of the eLISA noise PSD. Systems at higher redshifts start to tail off because the GW amplitude scales inversely to the luminosity distance; by $z = 1.5$, the distribution of detectable EMRIs with eLISA has essentially vanished. Eccentric prograde orbits around SMBHs with larger spins tend to produce larger SNRs because the periapsis in such systems can get much closer to the SMBH, and so the GWs are intrinsically louder. This effect also causes the detectable EMRIs to have smaller values of $p$ at plunge, as observed in its distribution.

EMRI systems within our populations have small eccentricities at plunge than initially due to the circularising effect of GWs~\cite{Peters1964}. For detectable systems, the mean eccentricity is $0.05$ and the maximum is $0.4$, $85\%$ have $e < 0.1$. In \secref{flux-enhance}, we found a strong eccentricity dependence on the magnitude of the resonant flux enhancements. We therefore expect typical resonant jumps in these astrophysical systems to be much less than $1\%$, and so the resultant dephasing to be relatively weak. We now analyse the $513$ systems using our NK models to check for the impact of resonances.

\subsection{Loss of signal-to-noise ratio}
\label{sec:population-SNR}

We can study the effect of resonances, by comparing the adiabatic evolution to the full instantaneous evolution; a loss in SNR will reduce the number of detected events. For each inspiral, we denote the longest period of time $t\sub{ad}$ in which neither the $1$:$2$ nor the $2$:$3$ resonance is encountered. From the results of \secref{effres-phase}, we expect the recovered overlap to be approximately given by the proportion of time spent in a resonance-free region, that is $t\sub{ad} / t\sub{insp}$. This assumes that there is perfect overlap in the absence of a resonance and zero overlap across an overlap, with all times during the inspiral contributing equally. 
%In \figref{pop-adSNR-vs-Tad}, we plot the maximum overlap between the instantaneous and adiabatic models against this ratio, highlighting the number of resonances, $N\sub{res}$, each system encounters. In the majority of cases, there is no significant impact on the recovered overlap using adiabatic models.
%We can better understand the overlap distribution from \figref{pop-adSNR-vs-Tad} by considering the behaviour with the mass ratio.
In \figref{pop-adSNR-vs-eta} we plot the difference between the computed maximum overlap and the value expected from the time between resonances, highlighting the number of resonances $N\sub{res}$ each system encounters.

\begin{figure}
\centering
%\includegraphics[width=0.46\textwidth]{pop_adSNR_vs_eta}
\includegraphics[width=0.4\textwidth]{Fig_res_overlap_t}
\caption{\label{fig:pop-adSNR-vs-eta}The difference between the maximum overlap and the expected value $t\sub{ad} / t\sub{insp}$, as a function of the mass ratio for our population of $513$ EMRI signals. Each system encounters either $0$ (circles), $1$ (squares) or $2$ (triangles) resonances during the observation window $t\sub{insp}$, with $t\sub{ad}$ the largest time spent by the inspiral without encountering any resonances.}
\end{figure}

A small proportion of systems have overlaps below the expected value (approximately $4\%$ have values less than $-0.05$). This might be caused by higher-order resonances disrupting the evolution, in which case $t\sub{ad}$ should be smaller and the systems would lie on the expectation line. However, a more likely explanation is that larger a sub-optimal matching time $t\sub{match}$ was used, and a larger overlap is achievable with a different choice of adiabatic evolution.

Roughly $30\%$ of the systems lie within $0.05$ of the expected value. However, the vast majority of these are not significantly disrupted by resonances, and produce overlaps approaching unity. For the smallest (most extreme) mass ratios, the inspiral rate is slow, and so the systems do not encounter either the $1$:$2$ or $2$:$3$ resonances during their lifetime. Meanwhile, for the largest (least extreme) mass ratios, the EMRIs encounter both resonances close to plunge. In each case, there is a long resonance-free region, allowing a high overlap to be recovered.

The remaining $66\%$ of systems have overlaps above the level expected if resonances lead to significant dephasing. These occur at low and intermediate values of the mass ratio, where the inspiral rate is slow enough that the low-order resonances are encountered in the middle of the observation window, and the resulting value of $t\sub{ad}$ is small. For these EMRIs, resonances are not as important as expected, which is likely due to the low eccentricities of our population leading to small (and in most cases, negligible) resonant flux enhancements.

Even assuming that all overlap reductions are due to transient resonances (neglecting contributions from imperfectly selected adiabatic waveforms), the overall effect on the population is not significant. To illustrate this, we plot the AK SNRs in \figref{pop-SNR-dist}, multiplied by the maximum recovered overlap to account for the loss in SNR caused by passing through resonance. The total number of detectable systems decreases from $513$ to $492$, a loss of $4\%$. If we increase the threshold $\rho\sub{thres}$, the fractional reduction in the number of detectable systems gets even smaller. We therefore conclude that resonances do not cause sufficient waveform dephasing across a population of EMRIs for the detection rate to be appreciably diminished.

\begin{figure}
\centering
%\includegraphics[width=0.46\textwidth]{pop_SNR_dist}
\includegraphics[width=0.4\textwidth]{Fig_res_pop_SNR_overlap}
\caption{\label{fig:pop-SNR-dist}Histogram showing the probability distribution function for the detectable EMRI SNRs, as calculated using the AK formalism (solid outline) and modified by the maximum adiabatic overlap (dashed outline). The tail below $\rho\sub{thres} = 15$ indicates the detections lost because of resonances.}
\end{figure}

\section{Conclusion}
\label{sec:conclusion}

Transient resonances in EMRIs are an important consideration in waveform modelling due to the high proportion of expected systems encountering a low-order resonance in the later stages of inspiral. Passing through resonance can lead to an enhancement or decrement in the radiated fluxes associated with orbital evolution, which in turn leads to a jump in the orbital parameters across the resonance. Including the signature of resonances is necessary for optimal analysis on EMRI signals. 

The duration of resonances and their effect on orbital parameters can be calculated. However, this requires a self-force model. We have made use of a low spin, first-order PN self force. This is of limited validity and so the results should be taken as qualitative estimates; however, the self-force model should suffice for illustrating the potential effects of resonances.

The resonant jump in the orbital parameters depends upon the orbital phase on resonance. This makes it difficult to predict, without detailed calculation, the evolution of an inspiral. The magnitude of the jump depends upon the order of resonance and the orbital eccentricity. The $2$:$3$ and $1$:$2$ resonances have the largest effects, and higher order resonance are less important. Crucially, jumps are smaller for lower eccentricity orbits. High eccentricity EMRIs may encounter jumps in their orbital parameters of a few percent, leading to rapid dephasing of their waveforms compared to those from an adiabatic evolution.

Amongst a population of sources, unmodelled resonances could diminish detection prospects. However, because of the circularising effects of GW emission, by the time that the most important resonances are encountered, the orbital eccentricity is low. Therefore, the overall effect on SNR recovery is small, and there is not a significant reduction in the number of detectable EMRIs.

While it may not be essential to model resonances to detect (at least a subpopulation of) EMRIs, an unresolved question here is how resonances would affect parameter estimation. Systematic biases may be introduced if inaccurate templates are used; equally, the distinctive features of resonances may allow more precise measurements to be made. Developing a more accurate self-force model is required for a complete quantitative understanding of the effects of transient resonances.

Adiabatic waveform models can still be used for EMRIs away from resonance. Therefore it may be possible to stitch together waveforms from a sequence of adiabatic evolutions, if the phase on resonance and the magnitude of the self-force can be predicted with sufficient accuracy. Such hybrid models merit further study as relatively simple ways of incorporating resonance effects into adiabatic models.


\begin{acknowledgments}
The authors extend our sincere gratitude to \'{E}anna Flanagan and Tanja Hinderer for providing their PN self-force code, without which this work would not be possible. We thank Tanja Hinderer, Jeandrew Brink, Maarten van de Meent, Leor Barack, Scott Hughes and Nico Yunes for useful conversations; Stanislav Babak for examining both \cite{BerryThesis2013} and \cite{ColeThesis2015}, and Christopher Moore with help preparing this manuscript. RHC was supported by STFC; CPLB thanks STFC and the Cambridge Philosophical Society; PC was supported by a Marie Curie Fellowship, and JRG was supported by the Royal Society. This is LIGO Document P1600251. 
\end{acknowledgments}

\appendix

\section{Location of resonances}\label{sec:location}

We can find the location of resonances by numerically solving $\Omega = n_r \Omega_r - n_\theta \Omega_\theta = 0$. \Figref{res-plane-2-5-95} shows the semilatus rectum, eccentricity and (cosine of the) inclination angle of the $\nu = 2/5$ resonance surface for a BH of spin $a_\ast = 0.95$. 
\begin{figure}
\centering
\includegraphics[width=0.46\textwidth]{Fig_res-2-5-95-plane}
\caption{\label{fig:res-plane-2-5-95}Location of the $2/5$ resonance surface for an $a_\ast = 0.95$ BH in terms of orbital semilatus rectum $p$, eccentricity $e$ and inclination $\iota$.}
\end{figure}
This is almost planar, inspiring us to look for a simple description that can help guide our search for resonance locations. Brink, Geyer and Hinderer~\cite{Brink2013} provide series expansions for the location of resonances in the limit of equatorial orbits for small spin and eccentricity. We do not follow this approach of trying to find analytic expressions for the resonance surface. The expressions become complicated when venturing away from limiting cases. Instead, we build an approximate phenomenological model and fit this to the resonance plane. %\footnote{A stopped clock is precisely correct twice a day, while a clock that is five minutes slow is never right but will often be close enough. Within this metaphor, our approximation would be a clock that varies between telling the correct time and being fifteen minutes off throughout the day: it is generally going to be good enough to give you a sense of the time but if you have an important event you should check with something better.}
This should be useful for designating the region in which resonance could be expected. To locate them precisely, it is necessary to solve $\Omega = 0$ numerically; the approximate model gives a suitable starting point.

The resonant semilatus rectum for any particular spin and resonance ratio can be well approximated as
\begin{equation}
p(e,\iota;a_\ast,\nu) \simeq A\frac{1 + B e + D \cos\iota}{1 - C\exp(e)}.
\end{equation}
The coefficients $\{A,B,C,D\}$ depend upon the spin and the particular resonance; they can be approximated as
\begin{align} 
A(a_\ast,\nu) \simeq {} & a_0\frac{1 + a_1\nu - a_2 \nu^2 - a_3 \nu a_\ast^2}{1 + a_4\nu - (1 + a_4)\nu^2}, \\
B(a_\ast,\nu) \simeq {} & b_0(1 - b_1\nu)\exp(-b_2\nu)(1 - b_3 a_\ast), \\
C(a_\ast,\nu) \simeq {} & c_0, \\
D(a_\ast,\nu) \simeq {} & d_0\left[1 - \exp(a_\ast)\right]\left[1 - d_1\exp(\nu)\right].
\end{align}
This gives us a total of $12$ parameters for our fit. Whilst this may sound large, if we were fitting an expansion to quadratic order in combinations of $\{e,\iota,a_\ast,\nu\}$ we would have $15$ parameters.\footnote{We find that this does not give as good a fit as our function.} Our optimised parameters are
\begin{equation}
\begin{array}{lll}
a_0 = 5.9854, & a_1 = 3.4116, & a_2 = 0.9253,\\
a_3 = 0.1959, & a_4 = 4.8846, & b_0 = 0.7692,\\
b_1 = 1.4752, & b_2 = 1.4861, & b_3 = 0.5974,\\
c_0 = 0.02332, & d_0 = 0.7968, & d_1 = 0.3115.
\end{array}
\end{equation}
These were fitted for all possible resonances with $n_r = 2$--$7$ as well as the $9$:$10$, $19$:$20$, $49$:$50$ and $99$:$100$ resonances; with SMBH spins of $a_\ast = 0.01$--$0.999$; for orbits with eccentricities $e = 0.01$--$0.99$, and inclinations $\cos\iota = -0.999999$--$0.999999$. 
%These were fitted for resonances with $\nu = 1/7, 1/6, 1/5, 1/4, 2/7, 1/3, 2/5, 3/7, 1/2, 4/7, 3/5, 2/3, 5/7, 3/4, 4/5, 5/6, 6/7, 9/10, 19/20, 49/50, 99/100$, with BH spins of $a_\ast = 0.01, 0.05, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.93, 0.95, 0.97, 0.99, 0.999$.
 
Using this approximation, the maximum error in $p$ for a given $a_\ast$ and $\nu$ is typically $\sim10\%$ and less that $1$ in absolute terms. The relative error in the semilatus rectum is illustrated in \figref{p-error}. 
\begin{figure*}[htp]
\centering
\centerline{\includegraphics[width=0.47\textwidth]{Fig_fit-error-max-plane}\quad\includegraphics[width=0.47\textwidth]{Fig_fit-error-RMS-plane}}
\caption{\label{fig:p-error}Relative error in the approximate semilatus rectum compared to the accurate numerical result as a function of BH spin $a_\ast$ and resonance ratio $\nu$. The left panel shows the maximum relative error and the right shows the root-mean-square error; in both cases we are marginalising over eccentricity and inclination.}
\end{figure*}
The largest fractional error is $\sim50\%$, this is for $a_\ast \rightarrow 1$ and $\nu \rightarrow 0$, and corresponds to small $p$, such that the absolute error is still small. Taking the root-mean-square across $e$ and $\iota$, the fractional error for a given $a_\ast$ and $\nu$ never exceeds $9\%$ and is typically less than $4\%$.

\section{Asymptotic solution for passage through resonance}\label{sec:res-asymptotic}

\input{./asymptotic.tex}

\bibliography{Resonances}

\end{document}
